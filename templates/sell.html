<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏Ç‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏≠‡∏Å</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
</head>
<body class="bg-light" style="font-family: 'Prompt', sans-serif;">
  <div class="container py-4">
    <h3 class="text-center mb-4">üì§ ‡∏Ç‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏≠‡∏Å</h3>

    <div class="mb-4">
      <input id="imeiInput" class="form-control form-control-lg" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡∏Ç 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢ IMEI">
    </div>

    <div id="resultArea"></div>

    <div class="text-center mt-3">
      <a href="/menu" class="btn btn-secondary">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</a>
    </div>
  </div>

  <script>
    $("#imeiInput").on("input", function () {
      const val = $(this).val();
      if (val.length === 4) {
        $.ajax({
          url: "/api/search_imei",
          type: "POST",
          contentType: "application/json",
          data: JSON.stringify({ partial_imei: val }),
          success: function (data) {
            let html = "";
            if (data.length === 0) {
              html = '<div class="alert alert-warning text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
            } else {
              data.forEach(item => {
                html += `
                  <form method="POST" class="bg-white p-3 rounded shadow-sm mb-3">
                    <input type="hidden" name="index" value="${item.index}">
                    <p><strong>${item.brand} ${item.model} ${item.storage}</strong><br>IMEI: ${item.imei}</p>
                    <input name="sell_price" class="form-control mb-2" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢" required>
                    <input name="buyer" class="form-control mb-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠" required>
                    <input name="note" class="form-control mb-2" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
                    <button type="submit" name="confirm" class="btn btn-success w-100">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</button>
                  </form>
                `;
              });
            }
            $("#resultArea").html(html);
          }
        });
      } else {
        $("#resultArea").html(""); // clear result
      }
    });
  </script>
</body>
</html>
